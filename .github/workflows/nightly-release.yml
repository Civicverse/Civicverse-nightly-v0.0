name: Nightly Release
on:
  schedule:
    - cron: '0 6 * * *' # Daily at 06:00 UTC
  workflow_dispatch:
jobs:
  build_and_tag:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Install frontend deps
        run: |
          cd frontend
          npm ci || npm install
      - name: Build frontend
        run: |
          cd frontend
          npm run build --if-present
      - name: Create nightly tag
        id: tag
        run: |
          TAG=nightly-$(date -u +"%Y%m%d-%H%M%S")
          git tag $TAG
          git push origin $TAG
          echo "tag=$TAG" >> $GITHUB_OUTPUT
      - name: Create GitHub release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.tag.outputs.tag }}
          name: Nightly ${{ steps.tag.outputs.tag }}
          body: Automated nightly build
